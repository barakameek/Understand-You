<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Persona Alchemy Lab</title>
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700&family=Merriweather:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <!-- Stylesheet -->
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="data:,"> <!-- Prevent favicon error -->
</head>
<body>
  <div class="app-container study-theme">
    
    <!-- Saving Indicator with ARIA live region -->
    <div id="saveIndicator" class="save-indicator hidden" role="status" aria-live="polite">
      <i class="fas fa-save" aria-hidden="true"></i>
      <span class="sr-only">Saving...</span>
      Saving...
    </div>

    <!-- Welcome Screen -->
    <section id="welcomeScreen" class="screen current" aria-labelledby="welcomeHeading">
      <header>
        <h1 id="welcomeHeading">
          Welcome to the Persona Alchemy Lab!
          <i class="fas fa-info-circle info-icon" title="This is the entry point to the application. Start a new 'Experiment' (questionnaire) or load your previous session." aria-hidden="true"></i>
        </h1>
      </header>
      <p>Discover Concept Cards that resonate with your essence and curate your unique Persona Tapestry.</p>
      <button id="startGuidedButton" class="button" aria-label="Begin Experimentation">Begin Experimentation</button>
      <button id="loadButton" class="button secondary-button hidden" aria-label="Load Previous Session">Load Previous Session</button>
    </section>

    <!-- Questionnaire Screen -->
    <section id="questionnaireScreen" class="screen hidden" aria-labelledby="questionnaireHeading" aria-hidden="true">
      <header>
        <div id="elementProgressHeader"></div>
        <p id="progressText"></p>
        <div id="dynamicScoreFeedback" role="status" aria-live="polite">
          Current <span id="feedbackElement">Element</span> Score: <span id="feedbackScore">5.0</span> (<span class="score-label">Moderate</span>)
          <i class="fas fa-info-circle info-icon" title="This shows your approximate score for the current element based on your answers so far. It helps visualize how your choices influence the outcome." aria-hidden="true"></i>
          <div class="score-bar-container">
            <div id="feedbackScoreBar" style="width: 50%;"></div>
          </div>
        </div>
      </header>
      <main id="questionContent"></main>
      <footer>
        <button id="prevElementButton" class="button back-button hidden" aria-label="Previous Element">Previous</button>
        <button id="nextElementButton" class="button next-button" aria-label="Next or View Persona">Next / View Persona</button>
      </footer>
    </section>

    <!-- Navigation Bar -->
    <nav id="mainNavBar" class="main-nav hidden" role="navigation" aria-label="Main Navigation">
      <button class="nav-button active" data-target="personaScreen" aria-label="Persona Tapestry">Persona Tapestry</button>
      <button class="nav-button" data-target="grimoireScreen" aria-label="Grimoire">Grimoire (<span id="grimoireCount">0</span>)</button>
      <button class="nav-button" data-target="studyScreen" aria-label="The Study">The Study</button>
      <button class="nav-button" data-target="repositoryScreen" aria-label="Repository">Repository</button>
      <button id="settingsButton" class="nav-button settings-button" title="Settings & Save/Load Options" aria-label="Settings">
        <i class="fas fa-cog" aria-hidden="true"></i>
      </button>
    </nav>

    <!-- Persona Screen -->
    <section id="personaScreen" class="screen hidden persona-screen" aria-labelledby="personaHeading" aria-hidden="true">
      <header class="persona-header">
        <h1 id="personaHeading">
          My Persona Tapestry
          <i class="fas fa-info-circle info-icon" title="This screen summarizes your calculated persona based on the questionnaire and provides tools to refine it by focusing on specific Concepts." aria-hidden="true"></i>
        </h1>
        <div class="view-toggle-buttons">
          <button id="showDetailedViewBtn" class="button small-button view-toggle-btn active" aria-label="Show Detailed View">Detailed View</button>
          <button id="showSummaryViewBtn" class="button small-button view-toggle-btn" aria-label="Show Summary View">Summary View</button>
        </div>
      </header>
      <div id="personaDetailedView" class="persona-view current">
        <section class="persona-overview">
          <h2>Core Foundation
            <i class="fas fa-info-circle info-icon" title="Your scores across the 6 core elements, based on the initial questionnaire. Expand each for details, interpretations, and your current Attunement level." aria-hidden="true"></i>
          </h2>
          <p>Your fundamental attributes and elemental attunement. Expand each element.</p>
          <div id="personaElementDetails"></div>
          <hr>
          <h2>Resources
            <i class="fas fa-info-circle info-icon" title="Insight is the primary currency, earned through discovery, reflection, and rituals. Spend it in The Study to research new Concepts or unlock deeper knowledge." aria-hidden="true"></i>
          </h2>
          <p>Gain Insight <i class="fas fa-brain insight-icon" aria-hidden="true"></i> through discovery and reflection. Spend it in The Study.</p>
          <p>Current Insight: <strong id="userInsightDisplayPersona">0.0</strong> <i class="fas fa-brain insight-icon" aria-hidden="true"></i></p>
          <div id="elementLibrary" class="element-library" aria-label="Element Library">
            <h2>Element Library
              <i class="fas fa-info-circle info-icon" title="Unlock deeper written insights about each core element by spending Insight. Higher levels reveal more complex nuances." aria-hidden="true"></i>
            </h2>
            <p>Unlock deeper knowledge about each core element.</p>
            <div id="elementLibraryButtons" class="library-buttons"></div>
            <div id="elementLibraryContent" class="library-content">
              <p>Select an Element above to view its deep dive content.</p>
            </div>
          </div>
        </section>
        <section class="persona-constellation">
          <h2>Persona Tapestry - Focus
            <i class="fas fa-info-circle info-icon" title="Mark Concepts from your Grimoire as 'Focus' here. This shapes your Tapestry Narrative, influences Focus Resonance, and may unlock unique content based on combinations." aria-hidden="true"></i>
          </h2>
          <p>Curate concepts to shape your active Persona.</p>
          <div class="tapestry-area" id="tapestryArea" aria-label="Focused Concepts Area">
            <h4 id="focusedConceptsHeader">
              Focused Concepts (0 / 5)
              <i class="fas fa-info-circle info-icon" title="The number of Concepts currently marked as Focus out of your total available slots. Slots can be increased via Milestones." aria-hidden="true"></i>
            </h4>
            <div id="focusedConceptsDisplay" class="focus-concepts-grid"></div>
          </div>
          <div id="focusElementalResonance" class="focus-resonance-section">
            <h3>Focus Resonance
              <i class="fas fa-info-circle info-icon" title="Shows the average elemental scores calculated ONLY from the Concepts currently marked as 'Focus'. This reflects the overall elemental balance of your curated Tapestry." aria-hidden="true"></i>
            </h3>
            <p>Average elemental scores of your focused concepts.</p>
            <div id="focusResonanceBars"></div>
          </div>
          <div class="tapestry-narrative-section">
            <h3>Tapestry Narrative
              <i class="fas fa-info-circle info-icon" title="A dynamically generated interpretation based on your Focused Concepts, highlighting dominant elements and potential synergies between them." aria-hidden="true"></i>
            </h3>
            <p id="tapestryNarrative">Mark concepts as "Focus" to generate narrative...</p>
          </div>
          <div class="grimoire-insights">
            <h3>Focus Themes
              <i class="fas fa-info-circle info-icon" title="Identifies the dominant Elements (those with high scores) appearing most frequently among your Focused Concepts." aria-hidden="true"></i>
            </h3>
            <p>Themes emerging from your focused concepts.</p>
            <ul id="personaThemesList"></ul>
          </div>
        </section>
      </div>
      <div id="personaSummaryView" class="persona-view hidden">
        <h2>Persona Summary
          <i class="fas fa-info-circle info-icon" title="A concise text overview combining your Core Foundation scores, Tapestry Narrative, and Focus Themes." aria-hidden="true"></i>
        </h2>
        <div id="summaryContent">
          <p>Generating summary...</p>
        </div>
      </div>
    </section>

    <!-- Grimoire Screen (other screens would be similarly updated) -->
    <section id="grimoireScreen" class="screen hidden grimoire-screen" aria-labelledby="grimoireHeading" aria-hidden="true">
      <header>
        <h1 id="grimoireHeading">
          The Grand Grimoire
          <i class="fas fa-info-circle info-icon" title="Your personal collection of discovered Concept Cards. Filter, sort, view details, mark Concepts for Focus, or sell unwanted Concepts for Insight." aria-hidden="true"></i>
        </h1>
      </header>
      <div id="grimoireControls">
        <label for="grimoireTypeFilter">Type:</label>
        <select id="grimoireTypeFilter">
          <option value="All">All Types</option>
        </select>
        <label for="grimoireElementFilter">Element:</label>
        <select id="grimoireElementFilter">
          <option value="All">All Elements</option>
        </select>
        <label for="grimoireRarityFilter">Rarity:</label>
        <select id="grimoireRarityFilter">
          <option value="All">All Rarities</option>
          <option value="common">Common</option>
          <option value="uncommon">Uncommon</option>
          <option value="rare">Rare</option>
        </select>
        <label for="grimoireSortOrder">Sort:</label>
        <select id="grimoireSortOrder">
          <option value="discovered">Date Added</option>
          <option value="name">Name</option>
          <option value="type">Type</option>
          <option value="rarity">Rarity</option>
        </select>
        <i class="fas fa-info-circle info-icon" title="Use these controls to filter and sort the Concepts displayed in your Grimoire below." aria-hidden="true"></i>
      </div>
      <div id="grimoireContent" class="card-grid"></div>
    </section>

    <!-- (Other screens like studyScreen and repositoryScreen would be updated similarly.) -->

  </div>
  <script src="script.js"></script>
</body>
</html>
