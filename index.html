
<!-- START OF FILE index.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Persona Alchemy Lab</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" crossorigin="anonymous" defer></script>
    <!-- Stylesheet -->
    <link rel="stylesheet" href="style.css"> <!-- Contains merged styles -->
    <link rel="icon" href="data:,"> <!-- Prevent favicon 404 error -->

    <!-- Removed inline styles - Ensure they are merged into style.css -->

</head>
<body>

    <!-- === Drawer Toggle Button === -->
    <button id="drawerToggle"
            class="drawer-toggle"
            aria-label="Open main menu"
            aria-expanded="false"
            aria-controls="sideDrawer">☰</button>

    <!-- === Help Button === -->
    <button id="helpBtn" class="icon-btn" title="Show quick tour"><i class="fas fa-question-circle"></i></button>

    <!-- === Sliding Drawer (Sidebar) === -->
    <aside id="sideDrawer" class="side-drawer" aria-hidden="true"> <!-- Start hidden -->
      <nav class="drawer-nav">
        <h3>Menu</h3>
        <button data-target="personaScreen" class="drawer-link"><i class="fa-solid fa-user"></i> Persona</button>
        <button data-target="workshopScreen" class="drawer-link hidden-by-flow"><i class="fa-solid fa-flask"></i> Workshop (<span id="drawerGrimoireCount">0</span>)</button>
        <button data-target="repositoryScreen" class="drawer-link hidden-by-flow"><i class="fa-solid fa-book-open"></i> Repository</button>
        <hr>
        <button id="drawerSettings" class="drawer-link"><i class="fa-solid fa-gear"></i> Settings</button>
        <button id="drawerThemeToggle" class="drawer-link"><i class="fa-solid fa-moon"></i> Theme</button>
      </nav>
    </aside>

    <!-- Onboarding Highlight Element -->
    <div id="onboardingHighlight" class="onboarding-highlight hidden"></div>

    <!-- Main Application Container -->
    <div class="app-container">

        <!-- Saving Indicator -->
        <div id="saveIndicator" class="save-indicator hidden"><i class="fas fa-save"></i> Saving...</div>

        <!-- Welcome Screen -->
        <div id="welcomeScreen" class="screen current card">
             <h1>Welcome to the Persona Alchemy Lab! <i class="fas fa-info-circle info-icon" title="Discover concepts reflecting your inner self through guided introspection and experimentation."></i></h1>
             <p>Uncover Concept Cards that resonate with your essence and weave your unique Persona Tapestry.</p>
             <button id="startGuidedButton" class="button btn">Begin Experimentation</button>
             <button id="loadButton" class="button secondary-button btn hidden">Load Previous Session</button>
             <p><small>Version: Enhanced v4.1 + XP/Leveling v1.0</small></p>
        </div>

        <!-- Questionnaire Screen -->
        <div id="questionnaireScreen" class="screen hidden card">
             <header>
                 <div id="elementProgressHeader" aria-label="Questionnaire Progress"></div>
                 <p id="progressText"></p>
                 <div id="dynamicScoreFeedback" style="display: none;" aria-live="polite">
                    Current <span id="feedbackElement">[Element]</span> Score: <span id="feedbackScore">5.0</span><span class="score-label">(Moderate)</span>
                    <i class="fas fa-info-circle info-icon" title="This shows your approximate score for the current element based on your answers so far. Final scores across all 7 elements (including RoleFocus) are calculated at the end."></i>
                    <div class="score-bar-container"> <div id="feedbackScoreBar" style="width: 50%;"></div> </div>
                 </div>
             </header>
             <main id="questionContent"></main>
             <footer>
                 <button id="prevElementButton" class="button back-button btn" style="visibility: hidden;">Previous Element</button>
                 <button id="nextElementButton" class="button next-button btn">Next Element</button>
             </footer>
        </div>

        <!-- Persona Screen -->
        <div id="personaScreen" class="screen hidden persona-screen">
             <header class="persona-header">
                 <h1>My Persona Tapestry <i class="fas fa-info-circle info-icon" title="This screen summarizes your calculated persona based on the questionnaire and focused Concepts. Use the Workshop to discover more Concepts."></i></h1>
                 <!-- **NEW**: XP Bar and Token Button -->
                 <div class="xp-bar-wrapper" title="Overall XP Progress (Resets visually per 100XP)">
                     <div id="xpBar"><span id="xpFill"></span></div>
                     <button id="openSanctumBtn" class="btn" title="Spend Level Tokens" disabled>
                         <i class="fas fa-bolt"></i> <span id="tokenCount">0</span>
                     </button>
                 </div>
                 <div class="view-toggle-buttons">
                     <button id="showDetailedViewBtn" class="button small-button view-toggle-btn active btn" aria-pressed="true">Detailed View</button>
                     <button id="showSummaryViewBtn" class="button small-button view-toggle-btn btn" aria-pressed="false">Summary View</button>
                 </div>
             </header>

             <!-- Detailed View -->
             <div id="personaDetailedView" class="persona-view current">
                 <div class="persona-overview">
                     <!-- Left Column -->
                     <div class="persona-column persona-elements-detailed card">
                         <h2>Core Foundation <i class="fas fa-info-circle info-icon" title="Your scores across the 7 core elements, based on the initial questionnaire. Expand each for details, interpretations, current Attunement, and unlockable Insights."></i></h2>
                         <p>Your fundamental attributes and elemental attunement. Expand each element below.</p>
                         <div id="personaElementDetails" aria-live="polite"></div>
                         <hr>
                         <h2 style="cursor: pointer; display: inline-block;" title="Click to toggle Insight Log">Resources <i class="fas fa-info-circle info-icon" title="Insight is the primary currency, earned through discovery, reflection, and rituals. Spend it in The Workshop to research new Concepts or unlock deeper knowledge."></i></h2>
                         <p>
                             Current Insight: <strong id="userInsightDisplayPersona">0.0</strong> <i class="fas fa-brain insight-icon"></i>
                             <button id="addInsightButton" class="button tiny-button btn" title="Get an Insight boost (cooldown applies)">
                                  <i class="fas fa-plus"></i> <span class="visually-hidden">Add Insight</span>
                             </button>
                         </p>
                         <div id="insightLogContainer" class="log-hidden" aria-live="polite"></div>
                     </div>
                     <!-- Right Column -->
                     <div class="persona-column persona-constellation card">
                          <h2>Persona Tapestry - Focus <i class="fas fa-info-circle info-icon" title="Mark Concepts from your Workshop as 'Focus' here (using the ☆ icon). This shapes your Tapestry Narrative and may unlock unique content based on combinations."></i></h2>
                          <p>Curate concepts to shape your active Persona.</p>
                          <div class="tapestry-area" id="tapestryArea">
                               <h4 id="focusedConceptsHeader">Focused Concepts (0 / X) <i class="fas fa-info-circle info-icon" title="The number of Concepts currently marked as Focus out of your total available slots. Slots can be increased via Milestones."></i></h4>
                               <div id="focusedConceptsDisplay" class="focus-concepts-grid concept-grid" aria-live="polite"></div>
                          </div>
                           <div class="grimoire-insights">
                              <h3>Focus Themes <i class="fas fa-info-circle info-icon" title="Highlights the dominant Elements based on your Focused Concepts."></i></h3>
                              <p>Dominant elemental themes emerging from your focus.</p>
                              <ul id="personaThemesList" aria-live="polite"><li>Mark Focused Concepts...</li></ul>
                          </div>
                          <div class="tapestry-narrative-section">
                              <h3>Tapestry Narrative <i class="fas fa-info-circle info-icon" title="A dynamically generated interpretation based on your Focused Concepts, highlighting dominant elements and potential synergies/tensions between them."></i></h3>
                              <p id="tapestryNarrative" aria-live="polite">Mark concepts as "Focus" to generate narrative...</p>
                              <div class="tapestry-actions">
                                  <button id="elementalDilemmaButton" class="button small-button btn" title="Engage with an Elemental Dilemma for Insight.">Elemental Dilemma</button>
                                  <button id="exploreSynergyButton" class="button small-button btn" disabled title="Focus concepts to explore synergies...">Explore Synergy</button>
                                  <button id="suggestSceneButton" class="button small-button btn" title="Suggest resonant scenes (Cost Insight)">Suggest Scenes (<span id="sceneSuggestCostDisplay">?</span> <i class="fas fa-brain insight-icon"></i>)</button>
                                  <button id="deepDiveTriggerButton" class="button small-button btn" title="Explore your focused Tapestry in the Resonance Chamber">Resonance Chamber</button>
                              </div>
                              <div id="sceneSuggestionOutput" class="scene-suggestion-output hidden"><h4>Scene Suggestion:</h4><p>Based on your current focus, this scene may resonate:</p><div id="suggestedSceneContent"></div></div>
                          </div>
                     </div>
                 </div>
             </div>

             <!-- Summary View -->
             <div id="personaSummaryView" class="persona-view hidden card">
                  <h2>Persona Summary <i class="fas fa-info-circle info-icon" title="A concise overview combining your Core Foundation scores, Tapestry Narrative, and Focus Themes, plus a visual profile chart."></i></h2>
                  <div id="summaryContent">
                        <h3>Core Essence</h3><div class="summary-section" id="summaryCoreEssenceText" aria-live="polite"><p>Loading...</p></div> <hr class="popup-hr">
                        <h3>Elemental Profile</h3><p style="text-align: center; font-size: 0.9em; color: var(--text-muted-color);">Visual representation of your 7 element scores.</p>
                        <div class="chart-container"> <canvas id="personaScoreChartCanvas" aria-label="Radar chart showing persona scores for the 7 elements"></canvas> </div>
                         <hr class="popup-hr">
                        <h3>Focused Tapestry</h3><div class="summary-section" id="summaryTapestryInfo" aria-live="polite"><p>Loading...</p></div>
                  </div>
             </div>
        </div>

        <!-- Workshop Screen -->
        <div id="workshopScreen" class="screen hidden workshop-screen hidden-by-flow">
          <aside class="panel research-bench" id="workshop-research-area">
            <h2><i class="fas fa-flask"></i> Research Bench</h2>
            <div id="element-research-buttons" class="research-chips"></div>
            <div id="daily-actions" class="daily-actions">
                 <button id="freeResearchButtonWorkshop" class="button free-research-button btn" disabled title="Daily meditation already performed today.">Perform Daily Meditation ☆</button>
                 <button id="seekGuidanceButtonWorkshop" class="button guidance-button btn" disabled title="Requires Insight">Seek Guidance (<span id="guidedReflectionCostDisplayWorkshop">?</span> <i class="fas fa-brain insight-icon"></i>)</button>
            </div>
          </aside>
          <main class="panel grimoire-library" id="workshop-library-area">
            <div class="library-header">
                <h2><i class="fas fa-book-open"></i> Grimoire Library</h2>
                <span class="workshop-insight-display">Insight: <strong id="userInsightDisplayWorkshop">0.0</strong> <i class="fas fa-brain insight-icon"></i></span>
            </div>
            <div class="library-controls" id="grimoire-controls-workshop">
                <div class="filter-controls">
                  <label>Type: <select id="grimoireTypeFilterWorkshop"></select></label>
                  <label>Element: <select id="grimoireElementFilterWorkshop"></select></label>
                  <label>Rarity: <select id="grimoireRarityFilterWorkshop"></select></label>
                  <label>Focus: <select id="grimoireFocusFilterWorkshop"><option value="All">All Focus</option><option value="Focused">Focused ★</option><option value="Not Focused">Not Focused</option></select></label>
                  <label>Search: <input type="text" id="grimoireSearchInputWorkshop" placeholder="Keyword" /></label>
                  <label>Sort: <select id="grimoireSortOrderWorkshop"><option value="discovered">Newest</option><option value="name">Name</option><option value="type">Type</option><option value="rarity">Rarity</option><option value="resonance">Resonance</option></select></label>
                  </div>
            </div>
            <div id="grimoire-shelves-workshop" class="grimoire-shelves-area"></div>
            <div id="grimoire-grid-workshop"></div>
          </main>
        </div>

        <!-- Repository Screen -->
         <div id="repositoryScreen" class="screen hidden repository-screen">
             <h1>Repository <i class="fas fa-info-circle info-icon" title="A collection of rare discoveries, daily tasks, and milestones achieved."></i></h1><p>Track your progress and review unique findings.</p>
             <div class="repository-layout">
                 <section id="repositoryFocusUnlocks" class="repository-section card" aria-labelledby="focus-unlocks-heading"><h2 id="focus-unlocks-heading"><i class="fas fa-link"></i> Focus Discoveries</h2><div class="repo-list focus-unlocks-list" aria-live="polite"></div></section>
                 <section id="repositoryScenes" class="repository-section card" aria-labelledby="scenes-heading"><h2 id="scenes-heading"><i class="fas fa-scroll"></i> Scene Blueprints</h2><div class="repo-list" aria-live="polite"></div></section>
                 <section id="repositoryExperiments" class="repository-section card" aria-labelledby="experiments-heading"><h2 id="experiments-heading"><i class="fas fa-flask"></i> Alchemical Experiments</h2><div class="repo-list" aria-live="polite"></div></section>
                 <section id="repositoryInsights" class="repository-section card" aria-labelledby="insights-heading"><h2 id="insights-heading"><i class="fas fa-lightbulb"></i> Elemental Insights</h2><div class="repo-list" aria-live="polite"></div></section>
                 <section id="dailyRitualsSection" class="repository-section card" aria-labelledby="rituals-heading"><h2 id="rituals-heading"><i class="fas fa-clock"></i> Daily Rituals</h2><ul id="dailyRitualsDisplayRepo" class="repo-list" aria-live="polite"></ul></section>
                 <section id="milestonesSection" class="repository-section card" aria-labelledby="milestones-heading"><h2 id="milestones-heading"><i class="fas fa-award"></i> Milestones</h2><ul id="milestonesDisplay" class="repo-list" aria-live="polite"></ul></section>
             </div>
         </div>

      <!-- Popups and Modals -->
      <div id="popupOverlay" class="overlay hidden" aria-hidden="true"></div>

      <!-- Concept Detail Popup -->
      <div id="conceptDetailPopup" class="popup hidden card card-popup" role="dialog" aria-modal="true" aria-labelledby="popupConceptName">
        <button id="closePopupButton" class="close-button" aria-label="Close Concept Detail">×</button>
        <div class="popup-header"><span id="popupCardTypeIcon" class="card-type-icon" aria-hidden="true">?</span><h3 id="popupConceptName">Concept Name</h3><p id="popupConceptType">Card Type</p></div>
        <div class="popup-main-content">
            <div class="popup-visual-area"><div id="popupVisualContainer" class="popup-visual" role="img" aria-label="Concept Art"><i class="fas fa-image card-visual-placeholder" title="Visual Placeholder"></i></div></div>
            <div class="popup-info-area">
                <section id="popupResonanceGaugeSection" class="popup-section popup-resonance-gauge-section hidden" aria-labelledby="resonance-heading"><h4 id="resonance-heading">Resonance</h4><div id="popupResonanceGaugeContainer" role="meter" aria-valuemin="0" aria-valuemax="10" aria-valuenow="5" aria-labelledby="resonance-label-text"><div id="popupResonanceGaugeBar" style="width: 50%;"></div><span id="popupResonanceGaugeLabel" class="popup-resonance-gauge-label" aria-hidden="true">Moderate</span></div><small id="popupResonanceGaugeText" aria-describedby="resonance-heading">Some similarities.</small></section>
                <section class="popup-section" aria-labelledby="overview-heading"><h4 id="overview-heading">Overview</h4><p id="popupBriefDescription" class="popup-brief-desc">...</p></section>
                <section class="popup-section" aria-labelledby="elaboration-heading"><h4 id="elaboration-heading">Elaboration</h4><p id="popupDetailedDescription" class="popup-detailed-desc">...</p></section>
                <section class="popup-section popup-related-concepts-section" aria-labelledby="related-heading"><h4 id="related-heading">Synergies / Related</h4><div id="popupRelatedConceptsTags" class="related-concepts-tags"><p><i>...</i></p></div></section>
            </div>
        </div>
        <div class="popup-collapsible-area">
            <!-- **NEW**: Card Unlocks Section -->
            <details id="popupCardUnlocksSection" class="collapsible-popup-section hidden">
                <summary>Card Augments <i class="fas fa-level-up-alt" aria-hidden="true"></i> <i class="fas fa-info-circle info-icon" title="Unlock additional content or perks for this card using Insight, based on its Element Level."></i></summary>
                <div id="popupCardUnlocksContent" class="collapsible-content" aria-live="polite">
                    <!-- Unlock buttons/status added by JS -->
                </div>
            </details>
            <!-- Legacy Lore Section (Potentially hidden/removed later) -->
            <details id="popupLoreSection" class="collapsible-popup-section hidden"><summary>Legacy Lore <i class="fas fa-scroll" aria-hidden="true"></i></summary><div id="popupLoreContent" class="collapsible-content" aria-live="polite"></div></details>
            <details id="popupRecipeDetails" class="collapsible-popup-section"><summary>Elemental Recipe <i class="fas fa-flask" aria-hidden="true"></i></summary><div class="collapsible-content"><div id="popupComparisonHighlights" aria-live="polite"></div><details class="element-details"><summary>View Full Score Comparison</summary><div class="profile-comparison"><div class="profile-column"><h5>Concept Scores</h5><div id="popupConceptProfile"></div></div><div class="profile-column"><h5>Your Scores</h5><div id="popupUserComparisonProfile"></div></div></div></details></div></details>
            <details id="myNotesSection" class="collapsible-popup-section my-notes-section"><summary>My Notes <i class="fas fa-pencil-alt" aria-hidden="true"></i></summary><div class="collapsible-content"><label for="myNotesTextarea" class="visually-hidden">Personal Notes</label><textarea id="myNotesTextarea" rows="3" placeholder="Add your personal reflections..."></textarea><button id="saveMyNoteButton" class="button small-button btn">Save Note</button><span id="noteSaveStatus" class="note-status" aria-live="assertive"></span></div></details>
        </div>
        <div class="popup-actions"><button id="addToGrimoireButton" class="button small-button add-grimoire-button btn hidden">Add to Grimoire</button><button id="markAsFocusButton" class="button small-button focus-button hidden btn">Mark as Focus</button> <!-- Sell button added dynamically --></div>
      </div>

      <!-- Research Results Popup -->
      <div id="researchResultsPopup" class="popup hidden research-results-popup card" role="dialog" aria-modal="true" aria-labelledby="research-results-heading"> <button id="closeResearchResultsPopupButton" class="close-button" disabled title="Make a choice for all" aria-label="Close Research Results">×</button> <h3 id="research-results-heading">Research Findings</h3><div id="researchPopupContent" class="research-popup-content" aria-live="polite"></div> <div class="popup-actions research-popup-actions"><small id="researchPopupStatus" aria-live="polite">Choose action...</small><button id="confirmResearchChoicesButton" class="button small-button hidden btn">Confirm & Close</button></div> </div>
      <!-- Reflection Modal -->
      <div id="reflectionModal" class="popup hidden reflection-modal card" role="dialog" aria-modal="true" aria-labelledby="reflectionModalTitle"> <button id="closeReflectionModalButton" class="close-button" aria-label="Close Reflection">×</button> <h3 id="reflectionModalTitle">Reflection</h3><p>Regarding <strong id="reflectionElement">[Element]</strong>:</p><p id="reflectionPromptText" class="prompt-text">...</p><div class="reflection-confirm form-group"><input type="checkbox" id="reflectionCheckbox"><label for="reflectionCheckbox">I have reflected.</label><br><input type="checkbox" id="scoreNudgeCheckbox" class="hidden"><label for="scoreNudgeCheckbox" id="scoreNudgeLabel" class="hidden score-nudge-label">Allow score nudge?</label></div><button id="confirmReflectionButton" class="button small-button btn" disabled>Confirm (+<span id="reflectionRewardAmount">?</span> <i class="fas fa-brain insight-icon"></i>)</button> </div>
      <!-- Settings Popup -->
      <div id="settingsPopup" class="popup hidden settings-popup card" role="dialog" aria-modal="true" aria-labelledby="settings-heading"> <button id="closeSettingsPopupButton" class="close-button" aria-label="Close Settings">×</button> <h3 id="settings-heading">Settings</h3><div class="settings-content"><p>Manage session data.</p><button id="forceSaveButton" class="button small-button btn">Force Save</button><button id="resetAppButton" class="button small-button back-button btn">Reset All Progress</button><p class="reset-warning"><strong>Warning:</strong> Resetting erases all progress.</p></div> </div>
       <!-- Tapestry Deep Dive Modal -->
      <div id="tapestryDeepDiveModal" class="popup hidden resonance-chamber-modal card" role="dialog" aria-modal="true" aria-labelledby="deepDiveTitle"> <button id="closeDeepDiveButton" class="close-button" aria-label="Close Resonance Chamber">×</button><div class="popup-header"><h3 id="deepDiveTitle">Resonance Chamber</h3></div> <div class="resonance-chamber-content"><div class="resonance-chamber-summary"><h4>Weaver's Summary</h4><p id="deepDiveNarrativeP" aria-live="polite">...</p><div class="focused-concepts-icons" id="deepDiveFocusIcons"></div></div><hr class="popup-hr"><div class="resonance-chamber-main"><nav class="aspects-navigation" id="deepDiveAnalysisNodes"><<h4>Aspects</h4><button class="aspect-node button small-button btn" data-node-id="elemental"><i class="fas fa-atom"></i> Elemental Flow</button><button class="aspect-node button small-button btn" data-node-id="archetype"><i class="fas fa-mask"></i> Concept Archetype</button><button class="aspect-node button small-button btn" data-node-id="synergy"><i class="fas fa-link"></i> Synergy & Tension</button><button id="contemplationNode" class="aspect-node button small-button contemplation-node btn" data-node-id="contemplation"><i class="fas fa-brain"></i> Focusing Lens (<span class="contemplation-cost">?</span> <i class="fas fa-brain insight-icon"></i>)</button></nav><div class="insight-scroll-panel" id="deepDiveDetailContent" role="region" aria-live="polite"><p><i>Select Aspect...</i></p></div></div></div> </div>
      <!-- Dilemma Modal -->
      <div id="dilemmaModal" class="popup hidden reflection-modal card" role="dialog" aria-modal="true" aria-labelledby="dilemma-heading"> <button id="closeDilemmaModalButton" class="close-button" aria-label="Close Dilemma">×</button><h3 id="dilemma-heading">Elemental Dilemma</h3><p id="dilemmaSituationText">...</p><hr class="popup-hr"><p id="dilemmaQuestionText">...</p><div class="slider-container" style="max-width: 90%; margin: 20px auto;"><label for="dilemmaSlider" class="visually-hidden">Choice Slider</label><input type="range" id="dilemmaSlider" class="slider" min="0" max="10" step="0.5" value="5"><div class="label-container"><span id="dilemmaSliderMinLabel">Min</span><span id="dilemmaSliderMaxLabel">Max</span></div><p class="value-text" aria-live="polite">Leaning: <span id="dilemmaSliderValueDisplay">Balanced</span></p></div><div class="reflection-confirm form-group"><input type="checkbox" id="dilemmaNudgeCheckbox"><label for="dilemmaNudgeCheckbox" title="Allow choice influence?">Allow Score Nudge?</label></div><button id="confirmDilemmaButton" class="button small-button btn">Confirm Choice (+3 <i class="fas fa-brain insight-icon"></i>)</button> </div>
      <!-- Info Popup -->
      <div id="infoPopup" class="popup hidden info-popup card" role="alertdialog" aria-modal="true" aria-labelledby="info-heading"> <button id="closeInfoPopupButton" class="close-button" aria-label="Close Info">×</button><div class="popup-header"><h3 id="info-heading">Information</h3></div><div class="popup-content"><p id="infoPopupContent">...</p></div><div class="popup-actions"><button id="confirmInfoPopupButton" class="button small-button btn">OK</button></div> </div>
      <!-- Onboarding Popup -->
      <div id="onboardingOverlay" class="overlay hidden" aria-hidden="true"> <div id="onboardingPopup" class="popup onboarding-popup hidden card" role="dialog" aria-modal="true" aria-labelledby="onboarding-heading"> <div class="popup-header"> <h2 id="onboarding-heading">Orientation</h2> <span id="tourProgress">?/?</span> </div> <div id="onboardingContent"><p>Loading...</p></div> <p class="onboarding-progress"><span id="onboardingProgress">Step ? of ?</span></p> <div class="onboarding-nav"> <div> <button id="skipTourBtn" class="btn-text small">Skip this tour</button> <button id="onboardingSkipButton" class="btn-text small">Skip ALL orientation</button> </div> <div> <button id="onboardingPrevButton" class="button small-button back-button btn" disabled>Previous</button> <button id="onboardingNextButton" class="button small-button btn">Next</button> </div> </div> </div> </div>
      <!-- **NEW**: Element Sanctum Modal -->
      <div id="sanctumModal" class="popup hidden card" role="dialog" aria-modal="true" aria-labelledby="sanctum-heading">
        <button class="close-button" id="closeSanctumBtn" aria-label="Close Element Sanctum">×</button>
        <div class="popup-header"><h3 id="sanctum-heading">Element Sanctum</h3></div>
        <div class="popup-content">
            <p>Spend Level Tokens (<i class="fas fa-bolt" style="color:var(--level-token-color)"></i> <span id="sanctumTokenCount">0</span> available) to upgrade an Element's Mastery Level (Max 3).</p>
            <div id="sanctumGrid" class="sanctum-grid">
                <!-- Sanctum items added by JS -->
            </div>
        </div>
      </div>
      <!-- Alerts & Toasts -->
      <div id="milestoneAlert" class="milestone-alert hidden card" role="alert"><span id="milestoneAlertText">Milestone!</span><button id="closeMilestoneAlertButton" aria-label="Close Alert">×</button></div>
      <div id="toastNotification" class="toast hidden card" role="status" aria-live="polite"><span id="toastMessage">...</span></div>

    </div> <!-- End App Container -->

    <!-- Scripts (Defer, Type Module) -->
    <script src="data.js" type="module" defer></script>
    <script src="js/config.js" type="module" defer></script>
    <script src="js/utils.js" type="module" defer></script>
    <script src="js/state.js" type="module" defer></script>
    <script src="js/ui.js" type="module" defer></script>
    <script src="js/gameLogic.js" type="module" defer></script>
    <script src="main.js" type="module" defer></script>

    <!-- Minimal Inline Styles -->
    <style> .visually-hidden { position: absolute; width: 1px; height: 1px; margin: -1px; padding: 0; overflow: hidden; clip: rect(0, 0, 0, 0); border: 0; } .log-hidden { display: none; } .onboarding-highlight { position: fixed; border: 3px dashed var(--accent-color, #ffd700); border-radius: 5px; box-shadow: 0 0 15px rgba(255, 216, 0, 0.7); pointer-events: none; z-index: 1049; transition: all 0.3s ease-in-out; display: none; } #onboardingOverlay.visible { display: flex; opacity: 1; } canvas#personaScoreChartCanvas { background-color: transparent !important; } .hidden-by-flow { display: none; } .clickable { cursor: pointer; } .hint-bubble { position: absolute; z-index: 1000; max-width: 210px; padding: 8px 10px; border-radius: 8px; background: var(--background-light); border: 1px solid var(--accent-color); box-shadow: 0 2px 6px rgba(0,0,0,.15); font-size: .85rem; line-height: 1.3; } .hint-bubble .hint-close { position: absolute; top: 4px; right: 6px; cursor: pointer; font-weight: bold; font-size: .9rem; color: var(--text-muted-color); } .hint-bubble .hint-close:hover { color: var(--danger-color); }
    </style>

</body>
</html>
<!-- END OF FILE index.html -->
