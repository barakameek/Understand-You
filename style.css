/* =========================================================
   Persona Alchemy Lab – Unified Visual‑Overhaul Stylesheet  
   (light + dark themes, masonry grid, questionnaire stepper,  
   tactile buttons, centred modals, reduced‑motion support)
   ========================================================= */

/* ---------- 0. Design Tokens -------------------------------- */
:root {
  /* —— brand palette (light) —— */
  --primary-color       : #1e90ff;   /* blue */
  --secondary-color     : #32cd32;   /* lime green */
  --accent-color        : #ff6347;   /* tomato */

  /* —— surfaces —— */
  --background-color    : #f0f0f0;   /* page */
  --background-light    : #ffffff;   /* card */
  --background-medium   : #f8f9fa;   /* raised */
  --background-dark     : #e9ecef;   /* navbar */

  /* —— text —— */
  --text-color          : #333;
  --text-muted-color    : #6c757d;

  /* —— misc —— */
  --link-color          : var(--primary-color);
  --border-color-light  : #dee2e6;
  --border-color-dark   : #adb5bd;
  --box-shadow          : 0 2px 4px rgba(0,0,0,.1);
  --border-radius       : 8px;
  --transition-duration : .3s;
  --spacing             : clamp(.75rem,1.2vw,1.25rem);
  --progress-pct        : 0%;

  /* —— element hues (kept for logic) —— */
  --attraction-color    : #ff6347;
  --interaction-color   : #4682b4;
  --sensory-color       : #32cd32;
  --psychological-color : #ffd700;
  --cognitive-color     : #8a2be2;
  --relational-color    : #ff8c00;
  --rolefocus-color     : #40e0d0;

  /* —— tag backgrounds —— */
  --category-wantToTry-border    : #add8e6;
  --category-liked-border        : #90ee90;
  --category-dislikedLimit-border: #ffb6c1;
  --category-coreIdentity-border : #ffe4b5;
  --category-uncategorized-border: #ddd;
}

/* ---------- dark‑theme override  ----------------------------- */
:root.dark {
  --primary-color       : #ffc870;   /* golden headings */
  --secondary-color     : #5fd9a6;   /* teal accents  */
  --accent-color        : #ff7c6b;   /* coral */

  --background-color    : #06121f;
  --background-light    : #0d1b2b;
  --background-medium   : #102136;
  --background-dark     : #081421;

  --text-color          : #dfe4ea;
  --text-muted-color    : #8aa0b6;
  --link-color          : #64b5f6;
  --border-color-light  : #133149;
  --border-color-dark   : #0e2537;
  --box-shadow          : 0 2px 8px rgba(0,0,0,.50);

  /* element tints */
  --attraction-color    : #ff7f7f;
  --interaction-color   : #87cefa;
  --sensory-color       : #90ee90;
  --psychological-color : #fffacd;
  --cognitive-color     : #dda0dd;
  --relational-color    : #ffa07a;
  --rolefocus-color     : #7fffd4;

  color-scheme: dark;
}

/* ---------- 1. Base Elements --------------------------------- */
html,body{margin:0;padding:0;font-family:'Arial',sans-serif;line-height:1.6;background:var(--background-color);color:var(--text-color);}
a{color:var(--link-color);text-decoration:none;transition:color .2s;}a:hover{color:var(--accent-color);}hr{border:none;border-top:1px dashed var(--border-color-light);}p{margin-bottom:1em;}

/* Fluid headings */
h1,h2,h3,h4,h5{margin:0 0 .75em 0;line-height:1.3;font-weight:bold;}
h1{font-size:clamp(1.75rem,2.2vw,2.4rem);color:var(--primary-color);text-align:center;}
h2{font-size:clamp(1.3rem,1.6vw,1.6rem);color:var(--primary-color);text-align:center;border-bottom:1px solid var(--border-color-light);padding-bottom:.4em;}
.persona-elements-detailed h2,.repository-section h2,.workshop-section h2{border:none;text-align:left;}
h3{font-size:1.2rem;color:var(--secondary-color);text-align:center;}

/* ---------- 2. Layout Shell ---------------------------------- */
.app-container{max-width:1450px;margin:var(--spacing) auto;background:var(--background-light);border-radius:var(--border-radius);box-shadow:var(--box-shadow);border:1px solid var(--border-color-light);overflow:hidden;}
.screen{height:calc(100dvh - 55px);overflow:auto;padding:calc(var(--spacing)*1.5) var(--spacing);box-sizing:border-box;}
.hidden{display:none!important}.current{display:block}

/* ---------- 3. Navigation Bar -------------------------------- */
.main-nav{position:sticky;top:0;z-index:900;display:flex;gap:.5rem;padding:.4rem var(--spacing);align-items:center;flex-wrap:wrap;background:var(--background-light);border-bottom:1px solid var(--border-color-light);box-shadow:0 1px 4px rgb(0 0 0 /.08);} 
.nav-button,.theme-toggle{background:none;border:none;color:var(--primary-color);padding:8px 12px;font-size:.95em;font-weight:600;cursor:pointer;border-bottom:3px solid transparent;border-radius:4px;transition:background .15s,color .15s,border-color .2s;font-family:inherit;white-space:nowrap;}
.nav-button:hover:not(.active){background:var(--secondary-color);color:#fff;}
.nav-button.active{color:var(--accent-color);border-bottom-color:var(--accent-color);} 
.theme-toggle{margin-left:auto;font-size:1.2rem;line-height:1;}
.theme-toggle:hover{background:rgba(0,0,0,.08);} 

/* ---------- 4. Buttons -------------------------------------- */
.button,.btn{display:inline-block;padding:10px 20px;background:var(--primary-color);color:#fff;border:none;border-radius:5px;text-transform:uppercase;font-weight:700;font-size:.9em;letter-spacing:.8px;box-shadow:var(--box-shadow);cursor:pointer;transition:background var(--transition-duration),transform .1s,box-shadow .1s;}
.button:hover,.btn:hover{background:var(--accent-color);box-shadow:0 2px 6px rgb(0 0 0 /.15);} 
.button:active,.btn:active{transform:scale(.97);} 
.button:disabled{background:#aaa;color:#eee;cursor:not-allowed;box-shadow:none;transform:none;}
.small-button{padding:7px 14px;font-size:.8em;} 
.back-button{background:var(--text-muted-color);} 
.secondary-button{background:var(--secondary-color);} 

/* ---------- 5. Questionnaire Stepper ------------------------ */
#elementProgressHeader{display:flex;position:relative;counter-reset:step;margin-bottom:1rem;gap:.25rem;padding:5px;background:rgba(0,0,0,.05);border:1px solid var(--border-color-light);border-radius:var(--border-radius);} 
#elementProgressHeader::before{content:"";position:absolute;inset:50% 0 auto;transform:translateY(-50%);height:4px;width:var(--progress-pct);background:var(--accent-color);transition:width .3s;border-radius:2px;z-index:0;} 
#elementProgressHeader .step{flex:1;text-align:center;font-size:.75rem;padding-bottom:.3rem;position:relative;color:var(--text-muted-color);font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;z-index:1;} 
#elementProgressHeader .step::before{counter-increment:step;content:counter(step);display:block;margin:0 auto .25rem;background:var(--border-color-dark);color:var(--background-light);width:1.75rem;height:1.75rem;line-height:1.75rem;border-radius:50%;border:2px solid var(--background-light);box-shadow:0 1px 2px rgb(0 0 0 /.1);transition:background .3s;} 
#elementProgressHeader .step.active{color:var(--primary-color);} 
#elementProgressHeader .step.active::before{background:var(--primary-color);box-shadow:0 0 0 3px var(--accent-color);border-color:var(--accent-color);} 
#elementProgressHeader .step.completed::before{background:var(--secondary-color);} 

/* ---------- 6. Cards & Masonry ------------------------------ */
.concept-grid{column-count:3;column-gap:var(--spacing);} 
.concept-grid .concept-card{break-inside:avoid;margin:0 0 var(--spacing);} 
@media(max-width:900px){.concept-grid{column-count:2;}}@media(max-width:600px){.concept-grid{column-count:1;}}

.concept-card{background:var(--background-light);border:1px solid var(--border-color-light);border-radius:var(--border-radius);box-shadow:var(--box-shadow);padding:12px;display:flex;flex-direction:column;transition:transform var(--transition-duration),box-shadow var(--transition-duration);cursor:pointer;}
.concept-card:hover{transform:translateY(-5px);box-shadow:0 4px 8px rgb(0 0 0 /.15);} 
.card-header{display:flex;align-items:center;gap:8px;margin-bottom:8px;padding-bottom:6px;border-bottom:1px dashed var(--border-color-light);} 
.card-name{font-weight:700;font-size:1.05em;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:var(--text-color);} 
.card-brief-desc{font-size:.88em;color:var(--text-muted-color);line-height:1.4;min-height:2.8em;-webkit-line-clamp:2;-webkit-box-orient:vertical;display:-webkit-box;overflow:hidden;margin-bottom:10px;}
.card-footer{margin-top:auto;font-size:.9em;}

/* ---------- 7. Popups --------------------------------------- */
.overlay{position:fixed;inset:0;z-index:990;background:var(--overlay-bg);backdrop-filter:blur(2px);transition:opacity .3s;opacity:1;}
.overlay.hidden{opacity:0;pointer-events:none;}
.popup{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--background-light);border:1px solid var(--border-color-dark);border-radius:var(--border-radius);box-shadow:0 8px 25px rgba(0,0,0,.2);width:92%;max-width:750px;max-height:85dvh;display:flex;flex-direction:column;overflow:hidden;z-index:1000;transition:opacity .3s,transform .3s;opacity:1;}
.popup.hidden{opacity:0;transform:translate(-50%,-45%);pointer-events:none;}
.popup-header{display:flex;align-items:center;gap:10px;background:var(--background-dark);padding:15px var(--spacing);border-bottom:1px solid var(--primary-color);flex-shrink:0;}
.popup-actions{padding:15px var(--spacing);border-top:1px solid var(--border-color-light);background:var(--background-medium);flex-shrink:0;text-align:right;}
.close-button{position:absolute;top:10px;right:12px;background:none;border:none;font-size:1.9em;line-height:1;color:var(--text-muted-color);cursor:pointer;transition:color .2s;}
.close-button:hover{color:var(--accent-color);} 

/* ---------- 8. Toast & milestone ---------------------------- */
.toast{position:fixed;bottom:20px;right:20px;background:rgba(50,50,50,.9);color:#fff;padding:10px 18px;border-radius:var(--border-radius);font-size:.9em;box-shadow:var(--box-shadow);opacity:0;transform:translateY(15px);transition:opacity .4s,transform .4s;z-index:1020;}
.toast.visible{opacity:1;transform:translateY(0);} 
.milestone-alert{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:var(--accent-color);color:var(--background-dark);padding:12px 20px;border-radius:var(--border-radius);box-shadow:0 4px 10px rgba(0,0,0,.2);display:flex;align-items:center;gap:15px;z-index:1010;transition:opacity .3s,transform .3s;} 
.milestone-alert.hidden{opacity:0;transform:translate(-50%,20px);} 

/* ---------- 9. Reduced‑motion ------------------------------- */
@media(prefers-reduced-motion:reduce){*{animation:none!important;transition:none!important;}}
